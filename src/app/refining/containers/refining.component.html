<div class="container">
  <h1 class="mat-h1">재련 최적화</h1>
  <div class="layout">
    <mat-tab-group class="mat-elevation-z1">
      <mat-tab label="가격 정보">
        <div class="p-16">
          <form [formGroup]="priceForm" class="price-form">
            <div class="cell">
              <img src="assets/파편.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 명예의 파편 </mat-label>
                <input type="number" matInput formControlName="파편" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/하급오레하.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 하급 오레하 융화제 </mat-label>
                <input type="number" matInput formControlName="하급오레하" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/중급오레하.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 중급 오레하 융화제 </mat-label>
                <input type="number" matInput formControlName="중급오레하" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/상급오레하.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 상급 오레하 융화제 </mat-label>
                <input type="number" matInput formControlName="상급오레하" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/명돌.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 명예의 돌파석 </mat-label>
                <input type="number" matInput formControlName="명돌" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/위명돌.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 위대한 명예의 돌파석 </mat-label>
                <input type="number" matInput formControlName="위명돌" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/경명돌.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 경이로운 명예의 돌파석 </mat-label>
                <input type="number" matInput formControlName="경명돌" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/수결.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 수호석 결정 </mat-label>
                <input type="number" matInput formControlName="수결" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/파결.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 파괴석 결정 </mat-label>
                <input type="number" matInput formControlName="파결" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/수호강석.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 수호강석 </mat-label>
                <input type="number" matInput formControlName="수호강석" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/파괴강석.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 파괴강석 </mat-label>
                <input type="number" matInput formControlName="파괴강석" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/은총.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 태양의 은총 </mat-label>
                <input type="number" matInput formControlName="은총" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/축복.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 태양의 축복 </mat-label>
                <input type="number" matInput formControlName="축복" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/가호.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 태양의 가호 </mat-label>
                <input type="number" matInput formControlName="가호" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/재봉술기본.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 재봉술 : 수선 기본 </mat-label>
                <input type="number" matInput formControlName="재봉술기본" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/재봉술응용.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 재봉술 : 수선 응용 </mat-label>
                <input type="number" matInput formControlName="재봉술응용" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/재봉술심화.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 재봉술 : 수선 심화 </mat-label>
                <input type="number" matInput formControlName="재봉술심화" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/야금술기본.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 야금술 : 단조 기본 </mat-label>
                <input type="number" matInput formControlName="야금술기본" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/야금술응용.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 야금술 : 단조 응용 </mat-label>
                <input type="number" matInput formControlName="야금술응용" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/야금술심화.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 야금술 : 단조 심화 </mat-label>
                <input type="number" matInput formControlName="야금술심화" />
              </mat-form-field>
            </div>
          </form>
        </div>
      </mat-tab>
      <mat-tab label="귀속 재료 정보">
        <div class="p-16">
          <form [formGroup]="bindedForm" class="price-form">
            <div class="cell">
              <img src="assets/파편.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 명예의 파편 </mat-label>
                <input type="number" matInput formControlName="파편" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/하급오레하.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 하급 오레하 융화제 </mat-label>
                <input type="number" matInput formControlName="하급오레하" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/중급오레하.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 중급 오레하 융화제 </mat-label>
                <input type="number" matInput formControlName="중급오레하" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/상급오레하.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 상급 오레하 융화제 </mat-label>
                <input type="number" matInput formControlName="상급오레하" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/명돌.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 명예의 돌파석 </mat-label>
                <input type="number" matInput formControlName="명돌" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/위명돌.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 위대한 명예의 돌파석 </mat-label>
                <input type="number" matInput formControlName="위명돌" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/경명돌.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 경이로운 명예의 돌파석 </mat-label>
                <input type="number" matInput formControlName="경명돌" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/수결.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 수호석 결정 </mat-label>
                <input type="number" matInput formControlName="수결" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/파결.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 파괴석 결정 </mat-label>
                <input type="number" matInput formControlName="파결" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/수호강석.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 수호강석 </mat-label>
                <input type="number" matInput formControlName="수호강석" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/파괴강석.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 파괴강석 </mat-label>
                <input type="number" matInput formControlName="파괴강석" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/은총.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 태양의 은총 </mat-label>
                <input type="number" matInput formControlName="은총" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/축복.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 태양의 축복 </mat-label>
                <input type="number" matInput formControlName="축복" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/가호.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 태양의 가호 </mat-label>
                <input type="number" matInput formControlName="가호" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/재봉술기본.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 재봉술 : 수선 기본 </mat-label>
                <input type="number" matInput formControlName="재봉술기본" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/재봉술응용.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 재봉술 : 수선 응용 </mat-label>
                <input type="number" matInput formControlName="재봉술응용" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/재봉술심화.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 재봉술 : 수선 심화 </mat-label>
                <input type="number" matInput formControlName="재봉술심화" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/야금술기본.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 야금술 : 단조 기본 </mat-label>
                <input type="number" matInput formControlName="야금술기본" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/야금술응용.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 야금술 : 단조 응용 </mat-label>
                <input type="number" matInput formControlName="야금술응용" />
              </mat-form-field>
            </div>
            <div class="cell">
              <img src="assets/야금술심화.png" />
              <mat-form-field floatLabel="always">
                <mat-label> 야금술 : 단조 심화 </mat-label>
                <input type="number" matInput formControlName="야금술심화" />
              </mat-form-field>
            </div>
          </form>
        </div>
      </mat-tab>
    </mat-tab-group>
    <mat-card>
      <mat-card-subtitle> 장비 정보 </mat-card-subtitle>
      <mat-card-content>
        <form [formGroup]="itemForm">
          <div>
            <mat-form-field>
              <mat-label>장비 종류</mat-label>
              <mat-select formControlName="type">
                <mat-option value="weapon">무기</mat-option>
                <mat-option value="armor">방어구</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label>장비 등급</mat-label>
              <mat-select formControlName="grade">
                <mat-option value="t3_1302">T3 1302 (희귀 ~ 영웅)</mat-option>
                <mat-option value="t3_1340">T3 1340 (전설 ~ 유물)</mat-option>
                <mat-option value="t3_1390"
                  >T3 1390 (상위 유물 ~ 고대)</mat-option
                >
              </mat-select>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label> 목표 단계 </mat-label>
              <mat-select formControlName="target">
                <mat-option *ngFor="let target of targetList" [value]="target"
                  >{{ target }}단계</mat-option
                >
              </mat-select>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label> 기본 확률 </mat-label>
              <input formControlName="baseProb" matInput type="number" />
              <span matSuffix>%</span>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label> 성장 지원 & 영지 연구 </mat-label>
              <input formControlName="additionalProb" matInput type="number" />
              <span matSuffix>%</span>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label> 실패로 추가된 확률 </mat-label>
              <input matInput formControlName="probFromFailure" type="number" />
              <span matSuffix>%</span>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label> 합계 확률 </mat-label>
              <input formControlName="totalProb" matInput type="number" />
              <span matSuffix>%</span>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label> 장인의 기운 </mat-label>
              <input matInput formControlName="jangin" type="number" />
              <span matSuffix>%</span>
            </mat-form-field>
          </div>
          <mat-checkbox formControlName="applyResearch"
            >영지 연구 적용</mat-checkbox
          >
        </form>
      </mat-card-content>
    </mat-card>
    <mat-card class="materials">
      <mat-card-subtitle>재료 정보</mat-card-subtitle>
      <ng-container *ngIf="materials.length > 0">
        <mat-card-title>필수 재료</mat-card-title>
        <mat-card-content>
          <div class="material-info" *ngFor="let material of materials">
            <img [attr.src]="'assets/' + material.name + '.png'" />
            <span>
              x {{ material.amount | number: ".0-0" }} =
              {{ material.price | number: ".2-2" }}골드</span
            >
          </div>
          <div>합계 : {{ materialPrice | number: ".2-2" }}골드</div>
          <mat-checkbox [(ngModel)]="reduceBindedMaterials"
            >귀속 필수 재료를 0골드로 계산</mat-checkbox
          >
        </mat-card-content>
        <mat-card-title>추가 재료</mat-card-title>
        <mat-card-content>
          <div class="material-info" *ngFor="let breath of breathes">
            <img [attr.src]="'assets/' + breath.name + '.png'" />
            <span>
              + {{ breath.prob | percent: ".2-2" }} x 0 ~
              {{ breath.amount | number: ".0-0" }}<br />개당
              {{ breath.price | number: ".2-2" }}골드</span
            >
          </div>
          <div>
            <mat-checkbox [(ngModel)]="reduceBindedBooks"
              >귀속 책을 0골드로 계산</mat-checkbox
            >
          </div>
          <div>
            <mat-checkbox [(ngModel)]="reduceBindedBreathes"
              >귀속 숨결을 0골드로 계산</mat-checkbox
            >
          </div>
          <div>
            <button
              *ngIf="materials.length > 0"
              (click)="calculate()"
              mat-raised-button
              color="primary"
            >
              계산
            </button>
          </div>
        </mat-card-content>
      </ng-container>
    </mat-card>
    <mat-tab-group class="mat-elevation-z1">
      <mat-tab label="최적 재련">
        <div class="p-16">
          <app-refine-table
            [price]="optimalPrice"
            [path]="optimalPath"
          ></app-refine-table>
        </div>
      </mat-tab>
      <mat-tab label="노숨 재련">
        <div class="p-16">
          <app-refine-table
            [price]="noBreathPrice"
            [path]="noBreathPath"
          ></app-refine-table>
        </div>
      </mat-tab>
      <mat-tab label="풀숨 재련">
        <div class="p-16">
          <app-refine-table
            [price]="fullBreathPrice"
            [path]="fullBreathPath"
          ></app-refine-table>
        </div>
      </mat-tab>
    </mat-tab-group>
    <mat-card class="notice">
      <mat-card-title> 주의사항 </mat-card-title>
      <mat-card-content>
        <h3>가격 정보는 자동으로 갱신되지 않습니다.</h3>
        <p>
          며칠 전 시세 정보를 기준으로 임시로 넣어둔 값이며, 변동된 시세에 따른
          가격은 직접 계산해서 기입하시는 것이 정확합니다. 모든 재료의 가격은
          1개당 골드로 입력되니, 수호석 결정과 같이 10개 단위로 거래되는
          재료들의 수치 입력에 주의해주세요.
        </p>
        <h3>숨결은 0개 혹은 최대치로만 투입합니다.</h3>
        <p>
          숨결을 일부만 투입하는 경우까지 고려하면 연산량이 지나치게 많아집니다.
          걸립니다. 따라서 각 재료별로 0개 혹은 최대치 투입 2가지 경우의 수만
          고려하고 있습니다. 이로 인해 귀속 숨결을 0골드로 계산할 시 약간의
          오차가 발생할 수 있습니다.
        </p>
        <h3>22단계 이상의 재련에서 렉이 걸릴 수 있습니다.</h3>
        <p>
          재련 확률이 낮은 경우에는 트라이 횟수가 많아지는 만큼 경우의 수가 크게
          늘어나 렉을 유발할 수 있습니다. "귀속 재료를 0골드로 계산" 옵션을
          활성화할 시 귀속 재료의 양에 따라 최대 10배까지 느려질 수 있습니다.
        </p>
        <h3>평균 비용을 줄이는 재료 투입을 제시할 뿐입니다.</h3>
        <p>
          운이 좋고 나쁜것은 어쩔 수 없습니다. 장기백을 봤다고 절 욕하시면
          곤란합니다.
        </p>
      </mat-card-content>
    </mat-card>
  </div>
</div>
