(()=>{"use strict";function*d(n,e=n.length){for(let t=0;t<n.length;t++)if(1===e)yield[n[t]];else{const i=d([...n.slice(0,t),...n.slice(t+1,n.length)],e-1);for(const c of i)yield[n[t],...c]}}const v=["\uacf5\uaca9\ub825 \uac10\uc18c","\uacf5\uaca9\uc18d\ub3c4 \uac10\uc18c","\ubc29\uc5b4\ub825 \uac10\uc18c","\uc774\ub3d9\uc18d\ub3c4 \uac10\uc18c"];function O(n,e){const t=Object.assign({},n);return Object.entries(e).forEach(([i,c])=>{t[i]||(t[i]=0),t[i]+=c}),t}function E(n,e,t,i,c,u){function p(r){return!!u.hasBuyPrice&&!r.buyPrice||r.tradeLeft<u.tradeLeft||u.exclude.has(r.id)}return function l(r,o,s,g,b){if(u.noPenalty&&function(r){return v.find(o=>{var s;return r[o]>=5*Math.floor((null!==(s=t[o])&&void 0!==s?s:0)/5+1)})}(r)||o>c)return[];if(b===e.length)return function(r){return Object.keys(u.effects).find(o=>r[o]<u.effects[o])}(r)?[]:[{effects:r,price:o,items:g}];const m=[],$=n[b],F=e[b];for(const h of $)s[h.name]||p(h)||m.push(...l(O(r,h.effects),o+h.price,Object.assign(Object.assign({},s),{[h.name]:!0}),Object.assign(Object.assign({},g),{[F]:h}),b+1));return m}(Object.values(i).reduce((r,o)=>O(r,o.effects),t),0,Object.fromEntries(Object.values(i).map(r=>[r.name,!0])),i,0)}function R(n){return JSON.stringify(Object.values(n.items).sort((e,t)=>e.name.localeCompare(t.name)))}function P(n,e,t,i,c){const u=Array.from(d(["\ubaa9\uac78\uc774","\uadc0\uac78\uc7741","\uadc0\uac78\uc7742","\ubc18\uc9c01","\ubc18\uc9c02"].filter(p=>!i[p])));let f=[];for(const p of n)for(const a of u){const l=[];for(let r=0;r<a.length;r+=1){const o=a[r],s=Object.entries(p[r]),g=t[`${s[0][0]}_${s[0][1]}_${s[1][0]}_${s[1][1]}_${o}`];g.length>0&&l.push(g)}if(l.length===a.length){f.push(...E(l,a,e,i,f.length?f[f.length-1].price:1/0,c));const r={};f.forEach(o=>{r[R(o)]=o}),f=Object.values(r),f.sort((o,s)=>o.price-s.price),f=f.slice(0,300)}}return f}addEventListener("message",({data:n})=>{const e=P(n.combinations,n.initialEffect,n.searchResult,n.fixedItems,n.filter);postMessage(e)})})();